apiVersion: v1
kind: Template
metadata:
  name: logging-cucumber
objects:
- kind: BuildConfig
  apiVersion: v1
  metadata:
    name: logging-cucumber
  spec:
    source:
      git:
        uri: ${GIT_SOURCE}
        ref: ${GIT_BRANCH}
      contextDir: test/cucumber
    strategy:
       dockerStrategy: {}
    output:
      to:
        kind: ImageStreamTag
        name: logging-cucumber:${IMAGE_TAG}
- apiVersion: v1
  kind: ImageStream
  metadata:
    name: logging-cucumber
  spec:
    lookupPolicy:
       local: true
- apiVersion: v1
  kind: Template
  metadata:
    name: logging-cucumber-job
  objects:
  - apiVersion: batch/v1
    kind: Job
    metadata:
      name: logging-cucumber-job
      labels:
        logging-infra: testing
    spec:
      parallelism: 1
      completions: 1
      template:
        metadata:
          name: logging-cucumber-job
        spec:
          containers:
          - name: logging-cucumber-job
            image: logging-cucumber:${IMAGE_TAG}
            env:
            - name: LOGLEVEL
              value: ${LOGLEVEL}
            - name: TAGS
              value: ${TAGS}
          restartPolicy: Never
          serviceAccount: aggregated-logging-elasticsearch
  parameters:
  - name: TAGS
    description: Run the feature files with these tags.  Defaults to all
    value: ""
    required: false
  - name: LOGLEVEL
    value: debug
    required: true
parameters:
- name: IMAGE_TAG
  value: latest
  required: true
- name: GIT_SOURCE
  value: https://github.com/openshift/origin-aggregated-logging
  required: true
- name: GIT_BRANCH
  value: master
  required: true
